================================================================================
                         FIX 500 ERROR - NOW!
================================================================================

PROBLEM:
  Getting "500 Internal Server Error" when trying to backup a file

CAUSE:
  Database has OLD schema without new columns (fileName, fileSize, completedAt)

SOLUTION:
  Delete database and let it recreate with NEW schema


3-STEP FIX:
===========

Step 1: STOP THE SERVER
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
In the terminal where backend is running:
  Press: Ctrl + C

You should see server stop message


Step 2: DELETE THE DATABASE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Go to backend folder and delete data.db:

Windows (PowerShell):
  cd backend
  del data.db

Mac/Linux (Terminal):
  cd backend
  rm data.db


Step 3: START SERVER AGAIN
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  npm start

Wait for messages:
  âœ“ Server running on http://localhost:3000
  âœ“ Connected to SQLite database
  âœ“ Admin user created: Liza


DONE! Now test:
===============

1. Open: http://localhost:3000
2. Login as Liza:
   Email: liza@gmail.com
   Password: 123456
3. Go to: http://localhost:3000/dashboard
4. Click "Backup" on any file
5. Should see: âœ… SUCCESS (no 500 error!)
6. Go to: http://localhost:3000/admin
7. Click "Activity & Audit Logs" in menu
8. See: ğŸ“¦ Backup History with your backup!


VISUAL STEPS:
=============

BEFORE FIX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Click Backup button                     â”‚
â”‚          â†“                              â”‚
â”‚ Error: 500 Internal Server Error        â”‚
â”‚        âŒ FAILED                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER FIX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Click Backup button                     â”‚
â”‚          â†“                              â”‚
â”‚ âœ… File backed up successfully!         â”‚
â”‚ Backup appears in Admin Dashboard       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


QUICK COMMANDS:
===============

Everything in one go (Mac/Linux):
  cd backend
  rm data.db
  npm start

Everything in one go (Windows PowerShell):
  cd backend
  del data.db
  npm start


WHAT HAPPENS:
==============

Old Database (data.db):
  â”œâ”€ backups table (OLD SCHEMA)
  â”‚  â”œâ”€ id
  â”‚  â”œâ”€ userId
  â”‚  â”œâ”€ fileId
  â”‚  â”œâ”€ backupPath
  â”‚  â””â”€ status
  â”‚  âŒ MISSING: fileName, fileSize, completedAt
  â”‚
  â””â”€ Other tables...

New Database (after delete + restart):
  â”œâ”€ backups table (NEW SCHEMA)
  â”‚  â”œâ”€ id
  â”‚  â”œâ”€ userId
  â”‚  â”œâ”€ fileId
  â”‚  â”œâ”€ fileName          â† NEW
  â”‚  â”œâ”€ backupPath
  â”‚  â”œâ”€ fileSize          â† NEW
  â”‚  â”œâ”€ status
  â”‚  â”œâ”€ completedAt       â† NEW
  â”‚  â””â”€ createdAt
  â”‚  âœ… ALL COLUMNS PRESENT
  â”‚
  â””â”€ Other tables...


WHY BACKUP FAILED:
===================

Backup Code Tries To:
  INSERT INTO backups 
    (userId, fileId, fileName, fileSize, backupPath, status, completedAt)
    VALUES (?, ?, ?, ?, ?, ?, ?)

Old Database Has:
  backups table with columns:
  (id, userId, fileId, backupPath, status, createdAt)

Result:
  âŒ INSERT fails because columns don't exist!
  âŒ Returns 500 error


After Fix:
  âœ… New database has all required columns
  âœ… INSERT succeeds
  âœ… Backup created successfully
  âœ… No more 500 error!


VERIFY IT WORKED:
=================

After restarting server, check:

âœ… Server message shows:
   "Server running on http://localhost:3000"

âœ… Database file exists:
   backend/data.db (should be ~50KB)

âœ… Can login as admin:
   liza@gmail.com / 123456

âœ… Backup button works:
   No 500 error, green success message

âœ… Backup appears in admin:
   Admin â†’ Activity & Audit Logs â†’ See card

âœ… Console has no errors:
   F12 â†’ Console tab â†’ No red messages


TIMELINE:
=========

Ctrl+C (stop server)                    â† 5 seconds
del data.db (delete database)           â† 2 seconds
npm start (restart server)              â† 10 seconds
Wait for init messages                  â† 5 seconds
                                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL TIME:                              ~22 seconds


WHAT YOU LOSE:
==============

When deleting data.db:
  âŒ Old backups are gone
  âŒ Old file records are gone
  âŒ Old user registrations are gone
  âœ… But you don't need them - you're testing!
  âœ… Admin user (Liza) is recreated automatically

When using production, you would:
  âœ… Back up database first
  âœ… Or migrate schema instead of delete
  But for testing/development, delete is fine!


AFTER FIX - FULL TEST:
======================

1. Login as Liza
   http://localhost:3000
   
2. Logout other users if logged in
   (clear old session)

3. Go to Team Dashboard
   http://localhost:3000/dashboard

4. Upload/Find a file to backup
   (Use Files section, Upload File)

5. Click Backup button
   âœ… Should see green success message

6. Go to Admin Dashboard
   http://localhost:3000/admin

7. Click "Activity & Audit Logs"
   (in left menu)

8. See Backup History Card
   ğŸ“¦ Backup History
   Shows: your backup with file name, size, time

9. Success! Feature is working!


IF STILL NOT WORKING:
====================

1. Check server terminal
   Should show no error messages

2. Check browser console (F12)
   Should show no red errors

3. Check if data.db exists
   ls backend/data.db  (Mac/Linux)
   dir backend\data.db  (Windows)
   Should exist and be ~50KB

4. Try once more:
   Ctrl+C to stop
   del data.db again
   npm start again
   Test again

5. If still failing, check for:
   - Database locked (close other apps)
   - File permissions (can write to backend/)
   - Disk space (at least 1GB free)
   - Node version (v12+)


SUMMARY:
========

Problem:    500 error on backup
Cause:      Old database schema
Solution:   Delete data.db and restart
Time:       ~30 seconds
Result:     Backup works perfectly!


Ready? Let's go!

Step 1: Ctrl+C
Step 2: del data.db (or rm data.db)
Step 3: npm start
Step 4: Test backup
Step 5: See it working! ğŸ‰

================================================================================
